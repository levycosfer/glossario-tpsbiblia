<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Glossário TPS Bíblia - CM57</title>
  <link rel="stylesheet" href="./assets/css/style.css">
  <style>
    .container {
      display: flex;
      flex-direction: row;
      gap: 20px;
      padding: 10px;
      flex-wrap: wrap;
    }

    .lista {
      width: 40%;
      max-height: 500px;
      overflow-y: auto;
      border-right: 1px solid #ccc;
      padding-right: 20px;
    }

    .item {
      margin: 5px 0;
      cursor: pointer;
      color: blue;
      text-decoration: underline;
    }

    .video {
      width: 60%;
      padding-left: 20px;
      float: right;
    }

    iframe {
      width: 100%;
      height: 315px;
    }

    @media (max-width: 768px) {
      .video {
        width: 100%;
        padding-left: 0;
        float: none;
        margin-bottom: 20px;
      }

      .container {
        flex-direction: column;
      }

      .lista {
        width: 100%;
        border-right: none;
        border-top: 1px solid #ccc;
        padding-right: 0;
        padding-top: 10px;
      }
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>

<!-- Header -->
<header>
  <div class="header-content">
    <img alt="Logo" src="./assets/img/logo_TPS.png" class="logo" style="max-width: 400px; width: 100%;">
    <h1>Glossário TPS Bíblia</h1>
  </div>
</header>

<!-- Container para Lateral e Conteúdo Principal -->
<div class="container">
  <div class="conteudo" id="conteudo">
    <h2>Ferramenta de busca de termos-sinais no Glossário TPS Bíblia</h2>

    <div style="display: flex; align-items: center; justify-content: center; gap: 20px; margin-bottom: 20px; flex-wrap: wrap;">
      <img src="./assets/img/57CM.png" class="cm" alt="CM 57" style="max-width: 160px;">
      <h1 style="margin: 0;">Lista de Sinais - CM57</h1>
    </div>

    <!-- Botão de Voltar -->
    <div class="voltar">
      <button onclick="window.location.href='maos.html'">CM</button>
      <button onclick="window.location.href='pesquisa-sinais.html'">Corpo</button>
      <button onclick="window.location.href='index.html'">Home</button>
    </div>

    <div id="loading" style="display: flex; justify-content: center; align-items: center; height: 100vh;">
      <div style="border: 8px solid #f3f3f3; border-top: 8px solid #d26601; border-radius: 50%; width: 60px; height: 60px; animation: spin 1s linear infinite;"></div>
    </div>    

    <div class="video" id="video"></div>
    <!-- Container com lista -->
    <div class="container">
      <div class="lista" id="lista"></div>
    </div>
  </div>
</div>

<!-- Script para carregar os dados -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script>
  const urlCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTmkPQQC6sVyHjBwCf3AMyk5VLhe28eT44mo2pjDA8tFRe_vDOqe5Yp-b3VzW9rr0JAcy_ASjYblz4w/pub?gid=423812609&single=true&output=csv"; 

    function normalizarTexto(texto) {
    return texto
      .normalize("NFD")                    // separa acentos
      .replace(/[̀-ͯ]/g, "")    // remove acentos
      .replace(/\s+/g, " ")               // normaliza múltiplos espaços
      .trim()                             // remove espaços nas bordas
      .toLowerCase();                     // transforma em minúsculas
  }

  async function carregarDados() {
  const resposta = await fetch(urlCSV);
  const texto = await resposta.text();

  Papa.parse(texto, {
    header: false,
    skipEmptyLines: true,
    complete: function(results) {
      const linhas = results.data.slice(1);
      const listaDiv = document.getElementById("lista");
      const videoDiv = document.getElementById("video");
      const nomesMap = new Map();

      linhas.forEach(colunas => {
        const nomeOriginal = colunas[1]?.trim();
        const youtube = colunas[12]?.trim();

        if (nomeOriginal && youtube && youtube.startsWith("https://")) {
          const chave = normalizarTexto(nomeOriginal);

          if (!nomesMap.has(chave)) {
            nomesMap.set(chave, { nome: nomeOriginal, youtube });
          }
        }
      });

      // Ordena alfabeticamente
      const nomesOrdenados = Array.from(nomesMap.values()).sort((a, b) => 
        a.nome.localeCompare(b.nome, 'pt-BR')
      );

      nomesOrdenados.forEach(({ nome, youtube }) => {
        const item = document.createElement('div');
        item.className = 'item';
        item.textContent = nome;
        item.addEventListener('click', () => {
          videoDiv.innerHTML = `
            <h2>${nome}</h2>
            <iframe src="${youtube.replace('watch?v=', 'embed/')}" frameborder="0" allowfullscreen></iframe>
          `;
        });
        listaDiv.appendChild(item);
      });

      document.getElementById('loading').style.display = 'none';
    }
  });
}

// Só chama uma vez
carregarDados();
</script> 

<!-- Footer -->
<footer>
  <!-- <p>Desenvolvido por <a href="https://github.com/levycosfer" target="_blank">GitHub by levycosfer</a></p> -->
</footer>
</body>
</html>
